<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-compressjs/node_modules/compressjs/lib/Dmc.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-compressjs">npmtest-compressjs (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-compressjs/node_modules/compressjs/lib/Dmc.js</span></h1>
    <h2>
        
        Statements: <span class="metric">20.19% <small>(21 / 104)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">2.94% <small>(1 / 34)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">11.11% <small>(1 / 9)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">19.42% <small>(20 / 103)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-compressjs/node_modules/compressjs/lib/</a> &#187; Dmc.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * Implementation of Dynamic Markov Compression, using byte-oriented
 * nodes/transitions.
 *
 * Currently no model-shrinking is done, so be careful trying to use
 * this on large inputs!
 *
 * Notes for the future / TO DO:
 *
 * Add node merging to Dmc:
 *  - once (total states traversed / total node count) exceeds a certain value
 *    - find the median node w/rt total visits
 *    - combine all nodes w/ less visits into a single node, with transitions
 *      to node[0] - node[255] (initial context-1 states)
 *      - initially transition counts are zero?  or summed from components?
 *        needs to be summed so kirchoff principle holds
 *    - halve the edge counts of all nodes, to provide for adaptation
 *      - enforce property that all nodes point "higher" except for
 *        links to nodes 0-255.  So we can resum all nodes in one pass,
 *        after resetting all node.sum to zero. X YES because we know
 *        what the total sum must be, so we can arrange to scale to maintain
 *        proper sum. XXX what about node 0-255? XXX maybe just clear all
 *        edge counts XXX
 *
 * Fix buglet: ensure that kirchoff principle *exactly* holds by
 * paying attention to rounding when we distribute edge counts.  track
 * highest edge and give (desiredSum - newSum) extra counts to that
 * outgoing edge? add one to each nonzero edge until all gone?
 *
 * Split 'to' nodes when to.sum grows too high -- only if we're
 * highest incoming edge?  Fix bug again here with saturating counts;
 * we can't ignore counts w/o violating kirchoff principle, so we need
 * to clone it.  Maybe start trying to clone early (before our counter
 * saturates) so we have a better chance of cloning on the high
 * incoming edge? XXX we don't track incoming edges.  XXX so just
 * clone when we visit.
 */
<span class="missing-if-branch" title="else path not taken" >E</span>if (typeof define !== 'function') { var define = require('amdefine')(module); }
define(['./MTFModel', './RangeCoder', './Stream', './Util'],function(MTFModel, RangeCoder, Stream, Util){
&nbsp;
// nm = no model cloning, MAX_TRANS_CNT=0xFF, MAX_MODEL_PROB=0xFFFF
// nm2 = "                            0xFFFF                 0xFFFF
// nm3 = "                             0xFFF                 0x0FFF
// nm4 = "                            0xFFFF                   0xFF
// cl1 = model cloning, MAX_TRANS_CNT=0xFFFF  MAX_MODEL_PROB=0xFF
// cl2 = model cloning, MAX_TRANS_CNT=  0xFF  MAX_MODEL_PROB=0xFF
// cl3 = model cloning, MAX_TRANS_CNT=0xFFFF  MAX_MODEL_PROB=0xFFFF
var MAX_TRANS_CNT = 0xFFFF;
var DEFAULT_MIN_CNT1 = 8;
var DEFAULT_MIN_CNT2 = 128;
var MODEL_PROB_MAX = 0xFF00;
var MODEL_PROB_INCR= 0x0100;
var CLONE_MODELS=false;
var PRINT_STATS=false; // for quick benchmarking
&nbsp;
// XXX need to limit growth of model (throw away and retrain if model
//     gets too large)
&nbsp;
var Dmc = Object.create(null);
Dmc.MAGIC = 'dmc!';
&nbsp;
var MarkovNode = <span class="fstat-no" title="function not covered" >function(coder, size, optModel) {</span>
<span class="cstat-no" title="statement not covered" >  this.out = [];</span>
<span class="cstat-no" title="statement not covered" >  this.model = optModel ? optModel.clone() :</span>
    new MTFModel(coder, size, MODEL_PROB_MAX, MODEL_PROB_INCR);
<span class="cstat-no" title="statement not covered" >  this.count = Util.makeU16Buffer(size);</span>
<span class="cstat-no" title="statement not covered" >  this.sum = 0;</span>
};
MarkovNode.prototype.clone = <span class="fstat-no" title="function not covered" >function(coder, size) {</span>
<span class="cstat-no" title="statement not covered" >  var i;</span>
<span class="cstat-no" title="statement not covered" >  var newNode = new MarkovNode(coder, size, CLONE_MODELS ? this.model : null);</span>
<span class="cstat-no" title="statement not covered" >  for (i=0; i&lt;size; i++) {</span>
<span class="cstat-no" title="statement not covered" >    newNode.out[i] = this.out[i];</span>
  }
<span class="cstat-no" title="statement not covered" >  return newNode;</span>
};
&nbsp;
var MarkovModel = <span class="fstat-no" title="function not covered" >function(coder, size, MIN_CNT1, MIN_CNT2) {</span>
<span class="cstat-no" title="statement not covered" >  var i, j;</span>
  // initial model is 'size' states, completely linked.
<span class="cstat-no" title="statement not covered" >  this.coder = coder;</span>
<span class="cstat-no" title="statement not covered" >  this.size = size;</span>
<span class="cstat-no" title="statement not covered" >  this.MIN_CNT1 = MIN_CNT1 || DEFAULT_MIN_CNT1;</span>
<span class="cstat-no" title="statement not covered" >  this.MIN_CNT2 = MIN_CNT2 || DEFAULT_MIN_CNT2;</span>
<span class="cstat-no" title="statement not covered" >  this.nodes = [];</span>
<span class="cstat-no" title="statement not covered" >  for (i=0; i&lt;size; i++) {</span>
<span class="cstat-no" title="statement not covered" >    this.nodes[i] = new MarkovNode(coder, size);</span>
  }
  // now link nodes
<span class="cstat-no" title="statement not covered" >  for (i=0; i&lt;size; i++) {</span>
<span class="cstat-no" title="statement not covered" >    for (j=0; j&lt;size; j++) {</span>
<span class="cstat-no" title="statement not covered" >      this.nodes[i].out[j] = this.nodes[j];</span>
    }
  }
  // select an arbitrary node as the start state.
<span class="cstat-no" title="statement not covered" >  this.current = this.nodes[0];</span>
};
MarkovModel.prototype.maybeSplit = <span class="fstat-no" title="function not covered" >function(from, symbol, to) {</span>
<span class="cstat-no" title="statement not covered" >  var trans_cnt = from.count[symbol];</span>
<span class="cstat-no" title="statement not covered" >  var next_cnt = to.sum;</span>
<span class="cstat-no" title="statement not covered" >  var i;</span>
<span class="cstat-no" title="statement not covered" >  if ( (trans_cnt &lt;= this.MIN_CNT1) ||</span>
       (next_cnt - trans_cnt &lt;= this.MIN_CNT2) ) {
<span class="cstat-no" title="statement not covered" >    return to; </span>// no split
  }
&nbsp;
  // split this guy!
<span class="cstat-no" title="statement not covered" >  var newNode = to.clone(this.coder, this.size);</span>
<span class="cstat-no" title="statement not covered" >  this.nodes.push(newNode);</span>
<span class="cstat-no" title="statement not covered" >  from.out[symbol] = newNode;</span>
  // distribute transition counts among new and cloned node
<span class="cstat-no" title="statement not covered" >  newNode.sum = to.sum = 0;</span>
<span class="cstat-no" title="statement not covered" >  for (i=0; i&lt;this.size; i++) {</span>
<span class="cstat-no" title="statement not covered" >    newNode.count[i] = to.count[i] * trans_cnt / next_cnt;</span>
<span class="cstat-no" title="statement not covered" >    newNode.sum += newNode.count[i];</span>
<span class="cstat-no" title="statement not covered" >    to.count[i] -= newNode.count[i];</span>
<span class="cstat-no" title="statement not covered" >    to.sum += to.count[i];</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  return newNode;</span>
};
MarkovModel.prototype.encode = <span class="fstat-no" title="function not covered" >function(symbol) {</span>
<span class="cstat-no" title="statement not covered" >  var from = this.current;</span>
<span class="cstat-no" title="statement not covered" >  from.model.encode(symbol);</span>
<span class="cstat-no" title="statement not covered" >  var to = from.out[symbol];</span>
<span class="cstat-no" title="statement not covered" >  if (from.count[symbol] !== MAX_TRANS_CNT) {</span>
<span class="cstat-no" title="statement not covered" >      from.count[symbol]++;</span>
<span class="cstat-no" title="statement not covered" >      from.sum++;</span>
  }
<span class="cstat-no" title="statement not covered" >  this.current = this.maybeSplit(from, symbol, to);</span>
};
MarkovModel.prototype.decode = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  var from = this.current;</span>
<span class="cstat-no" title="statement not covered" >  var symbol = from.model.decode();</span>
<span class="cstat-no" title="statement not covered" >  var to = from.out[symbol];</span>
<span class="cstat-no" title="statement not covered" >  if (from.count[symbol] !== MAX_TRANS_CNT) {</span>
<span class="cstat-no" title="statement not covered" >      from.count[symbol]++;</span>
<span class="cstat-no" title="statement not covered" >      from.sum++;</span>
  }
<span class="cstat-no" title="statement not covered" >  this.current = this.maybeSplit(from, symbol, to);</span>
<span class="cstat-no" title="statement not covered" >  return symbol;</span>
};
&nbsp;
Dmc.compressFile = Util.compressFileHelper(Dmc.MAGIC, <span class="fstat-no" title="function not covered" >function(inStream, outStream, fileSize, props) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  props = props || {};</span>
<span class="cstat-no" title="statement not covered" >  var MIN_CNT1 = (+props.m) || DEFAULT_MIN_CNT1;</span>
<span class="cstat-no" title="statement not covered" >  var MIN_CNT2 = (+props.n) || DEFAULT_MIN_CNT2;</span>
<span class="cstat-no" title="statement not covered" >  Util.writeUnsignedNumber(outStream, MIN_CNT1);</span>
<span class="cstat-no" title="statement not covered" >  Util.writeUnsignedNumber(outStream, MIN_CNT2);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var range = new RangeCoder(outStream);</span>
<span class="cstat-no" title="statement not covered" >  range.encodeStart(0xCA, 0);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var mm = new MarkovModel(range, (fileSize&lt;0) ? 257 : 256,</span>
                           MIN_CNT1, MIN_CNT2);
<span class="cstat-no" title="statement not covered" >  var inSize = 0;</span>
<span class="cstat-no" title="statement not covered" >  while (inSize !== fileSize) {</span>
<span class="cstat-no" title="statement not covered" >    var ch = inStream.readByte();</span>
<span class="cstat-no" title="statement not covered" >    if (ch===Stream.EOF) {</span>
<span class="cstat-no" title="statement not covered" >      mm.encode(256); </span>// end of stream
<span class="cstat-no" title="statement not covered" >      break;</span>
    }
<span class="cstat-no" title="statement not covered" >    mm.encode(ch);</span>
<span class="cstat-no" title="statement not covered" >    inSize++;</span>
  }
<span class="cstat-no" title="statement not covered" >  var outSize = range.encodeFinish();</span>
<span class="cstat-no" title="statement not covered" >  if (PRINT_STATS) {</span>
<span class="cstat-no" title="statement not covered" >    console.log('M1', mm.MIN_CNT1, 'M2', mm.MIN_CNT2,</span>
                'states', mm.nodes.length, 'size', outSize);
  }
});
&nbsp;
Dmc.decompressFile = Util.decompressFileHelper(Dmc.MAGIC, <span class="fstat-no" title="function not covered" >function(inStream, outStream, fileSize) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var MIN_CNT1 = Util.readUnsignedNumber(inStream);</span>
<span class="cstat-no" title="statement not covered" >  var MIN_CNT2 = Util.readUnsignedNumber(inStream);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var range = new RangeCoder(inStream);</span>
<span class="cstat-no" title="statement not covered" >  range.decodeStart();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  var mm = new MarkovModel(range, (fileSize&lt;0) ? 257 : 256,</span>
                           MIN_CNT1, MIN_CNT2);
<span class="cstat-no" title="statement not covered" >  var outSize = 0;</span>
<span class="cstat-no" title="statement not covered" >  while (outSize !== fileSize) {</span>
<span class="cstat-no" title="statement not covered" >    var ch = mm.decode();</span>
<span class="cstat-no" title="statement not covered" >    if (ch===256) {</span>
<span class="cstat-no" title="statement not covered" >      break; </span>// EOF
    }
<span class="cstat-no" title="statement not covered" >    outStream.writeByte(ch);</span>
<span class="cstat-no" title="statement not covered" >    outSize++;</span>
  }
<span class="cstat-no" title="statement not covered" >  range.decodeFinish();</span>
});
&nbsp;
return Dmc;
});
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Fri Apr 21 2017 09:46:12 GMT+0000 (UTC)</div>
</div>
</body>
</html>
